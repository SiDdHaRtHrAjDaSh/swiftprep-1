<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SwiftPrep</title>
    <link rel="stylesheet" type="text/css" href="http://localhost:3000/stylesheets/style.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@700&display=swap" rel="stylesheet"> 
    <link href= 
"https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.css"
            rel="stylesheet" /> 
  
    <script src= 
"https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.js"> 
    </script> 
  </head>
<body>
    <div style="width: 82%; margin-left: auto; margin-right: auto;">
    <nav class="navbar">
        <a href="/" class="navbar-brand"><img class="logo" src="http://localhost:3000/images/logo.png"></a>
            <% if(!currentUser){ %>
              <a class="nav-link" href="/google">Login</a>
            <% } else { %>
                <div class="dropdown">
                    <button class="btn btn-primary dropdown-toggle" type="button" id="dropdownMenu2" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        Profile
                    </button>
                    <div class="dropdown-menu" aria-labelledby="dropdownMenu2">
                      <button class="dropdown-item" type="button"><%= currentUser.username %></button>
                      <div class="dropdown-divider"></div>
                      <a href="/logout" class=" dropdown-item btn btn-primary">Logout</a>
                    </div>
                  </div>
            <% } %>
          </div>
      </nav>
    </div>

<div style="max-width: 1100px" >
    <video id="video1" class="video-js vjs-default-skin vjs-big-play-centered" controls  data-setup='{"playbackRates": [1, 1.25, 1.5, 1.75, 2], "fluid": true}'>
        <source src="https://<%= link %>.cloudfront.net/<%= video.VName %>.mp4" type="video/mp4">
        Your browser does not support the video tag.
    </video>
</div>

<div id="pg4-c">
<div class="ui comments">
  <h3 class="ui dividing header">Comments</h3> <br>
  <form action ='/view/<%= video._id %>/comment' method ='POST' class="ui reply form">
    <div class="field">
      <textarea name='comment' class="comment"></textarea>
    </div>
    <button class="ui blue labeled submit icon button" type="submit">
      <i class="icon edit"></i> Add Comment
    </button>
  </form>
  <% if (typeof video.comments != 'undefined' && video.comments != null) { %>
    <% video.comments.forEach(function(comment){ %>
  <div class="comment">
    <a class="avatar">
      <img src="<%= comment.author.dp %>">
    </a>
    <div class="content">
      <a class="author"><%= comment.author.username %></a>
      <div class="metadata">
        <span class="date"><%= comment.created.toUTCString() %></span>
      </div>
      <div class="text">
        <%= comment.text %>
      </div>
      <div class="actions">
        <a class="reply">Reply</a>
      </div>
    </div>
  
  <div class="comments">
    <% if(comment.replies != null) { %>
      <% comment.replies.forEach(function(reply){ %>
    <div class="comment">
      <a class="avatar">
        <img src="<%= reply.author.dp %>">
      </a>
      <div class="content">
        <a class="author"><%= reply.author.username %></a>
        <div class="metadata">
          <span class="date"><%= reply.created.toUTCString() %></span>
        </div>
        <div class="text">
          <%= reply.text %>
        </div>
      </div>
    </div>
    <% })} %>
  </div>
</div>
<form id="reply-form" action ='/view/<%= video._id %>/<%= comment._id %>/reply' method ='POST' class="ui reply form">
  <div class="field">
    <textarea name="reply" class="reply"></textarea>
  </div>
  <button class="ui blue labeled submit icon button" type="submit">
    <i class="icon edit"></i> Add Reply
  </button>
</form>
  <% })} %>
  </div>
</div>

<script>
  $(".actions").click(function(){
    $("#reply-form").fadeToggle(1000);
})
</script>

<%- include ("./partials/footer") %>