<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="shortcut icon" href="http://www.swiftprep.in/images/favicon/favicon.ico">
    <link rel="icon" sizes="16x16 32x32 64x64" href="http://www.swiftprep.in/images/favicon/favicon.ico">
    <link rel="icon" type="image/png" sizes="196x196" href="http://www.swiftprep.in/images/favicon/favicon-192.png">
    <link rel="icon" type="image/png" sizes="160x160" href="http://www.swiftprep.in/images/favicon/favicon-160.png">
    <link rel="icon" type="image/png" sizes="96x96" href="http://www.swiftprep.in/images/favicon/favicon-96.png">
    <link rel="icon" type="image/png" sizes="64x64" href="http://www.swiftprep.in/images/favicon/favicon-64.png">
    <link rel="icon" type="image/png" sizes="32x32" href="http://www.swiftprep.in/images/favicon/favicon-32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="http://www.swiftprep.in/images/favicon/favicon-16.png">
    <link rel="apple-touch-icon" href="http://www.swiftprep.in/images/favicon/favicon-57.png">
    <link rel="apple-touch-icon" sizes="114x114" href="http://www.swiftprep.in/images/favicon/favicon-114.png">
    <link rel="apple-touch-icon" sizes="72x72" href="http://www.swiftprep.in/images/favicon/favicon-72.png">
    <link rel="apple-touch-icon" sizes="144x144" href="http://www.swiftprep.in/images/favicon/favicon-144.png">
    <link rel="apple-touch-icon" sizes="60x60" href="http://www.swiftprep.in/images/favicon/favicon-60.png">
    <link rel="apple-touch-icon" sizes="120x120" href="http://www.swiftprep.in/images/favicon/favicon-120.png">
    <link rel="apple-touch-icon" sizes="76x76" href="http://www.swiftprep.in/images/favicon/favicon-76.png">
    <link rel="apple-touch-icon" sizes="152x152" href="http://www.swiftprep.in/images/favicon/favicon-152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="http://www.swiftprep.in/images/favicon/favicon-180.png">
    <meta name="msapplication-TileColor" content="#FFFFFF">
    <meta name="msapplication-TileImage" content="http://www.swiftprep.in/images/favicon/favicon-144.png">
    <meta name="msapplication-config" content="http://www.swiftprep.in/images/favicon/browserconfig.xml">
    <title>SwiftPrep</title>
    <link rel="stylesheet" type="text/css" href="http://www.swiftprep.in/stylesheets/style.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@700&display=swap" rel="stylesheet"> 
    <link href= 
"https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.css"
            rel="stylesheet" /> 
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <script src= 
"https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.4.1/semantic.min.js"> 
    </script> 
  </head>
<body>
  <div style=" margin-left: auto; margin-right: auto;width:100%;background-color: white;">
    <nav class="navbar">
        <a href="/" class="navbar-brand"><img class="logo" src="http://www.swiftprep.in/images/logo.png"></a>
            <% if(!currentUser){ %>
              <a class="nav-link" href="/google">Login</a>
            <% } else { %>
                <div class="dropdown">
                    <button class="btn btn-primary dropdown-toggle" type="button" id="dropdownMenu2" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        Profile
                    </button>
                    <div class="dropdown-menu" aria-labelledby="dropdownMenu2">
                      <button class="dropdown-item" type="button"><%= currentUser.username %></button>
                      <div class="dropdown-divider"></div>
                      <a href="/logout" class=" dropdown-item btn">Logout</a>
                    </div>
                  </div>
            <% } %>
          </div>
      </nav>
    </div>

<div style="max-width: 1100px" >
    <video id="video1" class="video-js vjs-default-skin vjs-big-play-centered" controls  data-setup='{"playbackRates": [1, 1.25, 1.5, 1.75, 2], "fluid": true}'>
        <source src="https://<%= link %>/<%= bucket %>/<%= video.VName %>.mp4" type="video/mp4">
        Your browser does not support the video tag.
    </video>
</div>

<div id="comment-o" class="container bootstrap snippets bootdey">
  <div class="row">
  <div class="col-md-12">
      <div class="blog-comment">
      <h3 class="text-success">Comments</h3>
              <hr/>
              <form action ='/view/<%= video._id %>/comment' method ='POST'>
                <div class="form-group">
                  <label for="exampleFormControlTextarea1">Add Comment</label>
                  <textarea class="form-control" id="exampleFormControlTextarea1" name="comment" rows="3"></textarea>
                </div>
                <button class="btn btn-info" type="submit">
                  Add Comment
               </button>
              </form><br>
              <ul class="comments">
                <% if (typeof video.comments != 'undefined' && video.comments != null) { %>
                  <% video.comments.forEach(function(comment){ %>
              <li class="clearfix" id="listt">
                <img src="<%= comment.author.dp %>" class="avatar" alt="">
                <div class="post-comments">
                    <p class="meta">
                      <a href="#"><big><%= comment.author.username %></big></a> 
                      <%= comment.created.toUTCString() %>
                        <div style="float: right;" class="btn-group">
                          <button class="btn btn-primary btn-sm" type="button" id="<%= comment._id %>" onclick="toggleReplyBox(this.id)">
                            Reply
                          </button>
                          <% if(currentUser && comment.author.id.equals(currentUser._id)){ %>
                          <button type="button" class="btn btn-sm btn-primary dropdown-toggle dropdown-toggle-split" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <span class="sr-only">Toggle Dropdown</span>
                          </button>
                          <div class="dropdown-menu">
                            <form id="delForm" action="/view/<%= video._id %>/<%= comment._id %>?_method=DELETE" method="POST">
                              <button class="dropdown-item" id="butn-dd" type="submit">Delete</button>
                            </form>
                          <% } %>
                        </div>
                    </p>
                    <p style="white-space: pre-line;"><%= comment.text %></p>
                </div>
                <% if(comment.replies.length != 0) { %>
                <a class="btn btn-info" style='position:relative;transition: .5s ease;left:9%;' data-toggle="collapse" href="#page_<%= comment._id %>" aria-expanded="false" aria-controls="page_<%= comment._id %>"><i class="fa fa-arrow-down"></i>  View <%=comment.replies.length%> Replies</a>
                <div class='collapse' id= "page_<%= comment._id %>">
                <ul class="comments">
                    <% comment.replies.forEach(function(reply){ %>
                    <li class="clearfix">
                        <img src="<%= reply.author.dp %>" class="avatar" alt="">
                        <div class="post-comments">
                            <p class="meta"> 
                              <a href="#"><big><%= reply.author.username %></big></a>
                              <%= reply.created.toUTCString() %>
                              <% if(currentUser && reply.author.id.equals(currentUser._id)){ %>
                              <div style="float: right;" class="btn-group">
                                <button type="button" class="btn btn-sm btn-primary dropdown-toggle dropdown-toggle-split" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                  <span class="sr-only">Toggle Dropdown</span>
                                </button>
                                <div class="dropdown-menu">
                              <form action="/view/<%= video._id %>/<%= comment._id %>/<%= reply._id %>?_method=DELETE" method="POST">
                                <button type="submit" class="dropdown-item">Delete</button>
                              </form>
                                </div>
                              </div>
                              <% } %>
                            </p>
                            <p style="white-space: pre-line;"><%= reply.text %></p>
                        </div>
                    </li> 
                    <% }) %>
                </ul>
                </div>
                <% } %>
                <form action ='/view/<%= video._id %>/<%= comment._id %>/reply' method ='POST' class="<%= comment._id %>" style="display: none;">
                  <div class="form-group">
                    <label for="exampleFormControlTextarea1">Add Reply</label>
                    <textarea class="form-control" id="exampleFormControlTextarea1" name="reply" rows="3"></textarea>
                  </div>
                  <button class="btn btn-info" type="submit">
                     Add Reply
                  </button>
                </form> <br>
              </li> <% })} %>
              </ul>
            </div>
          </div>
        </div>
        </div>


<script>
  function toggleReplyBox(CommentID) {
    $('.'+CommentID).fadeToggle(500);
}

</script>

<%- include ("./partials/footer") %>
